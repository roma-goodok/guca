<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Graph Unfolding Cellular Automata ‚Äî Demo</title>
  <style>
    :root{
      --panel-w: 420px;
      --bg-dark:#101113;
      --bg-panel:#f6f7f9;
      --border:#d8dbe2;
      --accent:#0ea5e9;
      --ok:#16a34a;
      --muted:#6b7280;
      --tile-shadow: 0 0 0 1px rgba(0,0,0,.15) inset;
    }
    *{box-sizing:border-box}
    body{
      margin:0; height:100vh; display:flex; flex-direction:column;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans";
      color:#0b0c0e; background:#fff;
    }

    /* Header (collapsible About) */
    header{border-bottom:1px solid var(--border); background:#fff}
    header .wrap{max-width:1400px; margin:0 auto; padding:8px 12px}
    details.about{margin:0 auto; max-width:1400px; padding:6px 12px}
    details.about summary{
      list-style:none; cursor:pointer; user-select:none; outline:none;
      font-weight:600; display:flex; gap:10px; align-items:center;
    }
    details.about summary::-webkit-details-marker{display:none}
    .about-body{color:#222; margin-top:6px; line-height:1.45}
    .about-body p{margin:.4rem 0}
    .pill{display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border:1px solid var(--border); border-radius:999px; font-size:.85rem; background:#fff}
    .about-row{display:flex; align-items:center; gap:8px; max-width:1400px; margin:0 auto; padding:0 12px;}


    /* Main split layout */
    #main{flex:1; min-height:0; display:flex;}
    #canvas-container{
      flex:1; min-width:0; display:flex; align-items:center; justify-content:center;
      background:#000; border-right:1px solid var(--border); position:relative;
    }
    svg{width:100%; height:100%; background:#000;}

    #ui-panel{
      width:var(--panel-w); min-width:280px; max-width:50vw;
      background:var(--bg-panel); padding:10px; display:flex; flex-direction:column; gap:10px;
      overflow:auto;
    }
    h4{margin:8px 0 6px 0}

    .control-group{background:#fff; border:1px solid var(--border); border-radius:8px; padding:10px}
    .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .toggle-group{display:flex; gap:6px}
    .toggle-btn{
      border:1px solid #cfd5dd; background:#fff; border-radius:6px; padding:6px 10px; cursor:pointer;
    }
    .toggle-btn.active{background:#111827; color:#fff; border-color:#111827}

    /* Rules ‚Üí gene tiles */
    #rules-section .board{
      display:flex; flex-wrap:wrap; gap:6px; max-height:180px; overflow:auto;
      background:#fff; border:1px solid var(--border); padding:8px; border-radius:8px;
    }
    .gene-tile{
      width:44px; height:28px;
      display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr;
      border-radius:6px; box-shadow:var(--tile-shadow); position:relative;
      border:2px solid transparent;
      cursor:pointer;
    }
    /* .gene-tile span{
      display:block; width:100%; height:100%;
      pointer-events: none;
    } */
    .gene-tile.active{
      /* existing glow kept */
      box-shadow:0 0 10px rgba(34,197,94,.75), var(--tile-shadow);
      border-color:#22c55e;
      border-width:3px;
    }
    .gene-tile.disabled{
      filter:grayscale(100%) brightness(.85);
      opacity:.8;
      border-color:#9ca3af;
      border-style:dashed;
    }
    .gene-tile.disabled span{
      filter:grayscale(100%) brightness(.85);
    }
    .gene-tile:hover{
      outline:2px solid var(--accent);
      outline-offset:2px;
    }

    .legend{font-size:.85rem; color:#374151; display:flex; gap:8px; flex-wrap:wrap}

    /* Footer status bar */
    footer{
      height:34px; background:var(--bg-dark); color:#e5e7eb;
      display:flex; align-items:center; justify-content:space-between; padding:0 12px;
      border-top:1px solid #0b0c0f; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    }
    footer .left, footer .right{display:flex; align-items:center; gap:10px}

    /* Links & edges */
    .link{vector-effect: non-scaling-stroke; stroke-width:2; stroke-linecap:round}

    /* Advanced collapsers */
    details.block summary{
      cursor:pointer; user-select:none; font-weight:600; color:#111827; list-style:none; outline:none;
    }
    details.block summary::-webkit-details-marker{display:none}
    details.block{border:1px solid var(--border); background:#fff; border-radius:8px; padding:8px 10px}

    /* Form bits */
    select, input[type="number"]{padding:6px 8px; border:1px solid #cfd5dd; border-radius:6px; background:#fff}
    label{color:#111827}
  </style>
</head>
<body>
  <header>
    <div class="about-row">
      <details class="about">
        <summary>‚ÑπÔ∏è About this demo</summary>
        <div class="about-body">
          <p>‚ÄúGenes‚Äù are change-tables for a Graph Unfolding Machine (GUM). Each step snapshots node states and applies the first matching rule. The demo lets you load YAML genomes, watch growth, and use a ‚úÇÔ∏è <b>Scissors</b> tool to cut edges.</p>
          <p>Tip: wheel zoom works in both tools; drag nodes when the üñêÔ∏è <b>Move</b> tool is active.</p>
        </div>
      </details>
      <a class="pill" href="https://github.com/roma-goodok/guca" target="_blank" rel="noopener">
        GitHub: roma-goodok/guca
      </a>
    </div>

  </header>

  <div id="main">
    <div id="canvas-container">
      <svg></svg>
    </div>

    <aside id="ui-panel">
      <div class="control-group">
        <label for="gene-select"><b>Genome (YAML)</b></label>
        <div class="row">
          <select id="gene-select" style="flex:1"></select>
          <button id="download-yaml-button" class="toggle-btn" title="Export current genome">‚§ì Export</button>
        </div>
        <div class="row" style="margin-top:6px">
          <label for="gene-upload">Upload:</label>
          <input id="gene-upload" type="file"
                 accept=".yaml,.yml,.json,application/x-yaml,text/yaml,application/json"/>
        </div>
      </div>

      <div class="control-group">
        <h4>Tools</h4>
        <div class="toggle-group">
          <button id="tool-move-button" class="toggle-btn active" title="Move / pan / drag nodes">üñêÔ∏è Move</button>
          <button id="tool-scissors-button" class="toggle-btn" title="Cut edges while dragging">‚úÇÔ∏è Scissors</button>
          <button id="slowdown-button" class="toggle-btn" title="Toggle slow mode">üê¢ Slow down</button>
        </div>
      </div>

      <div class="control-group">
        <h4>Graph Constraints</h4>
        <label><input type="checkbox" id="maintain-single-component" checked> Maintain a single component</label>
      </div>

      <div id="rules-section" class="control-group">
        <h4>Rules (Genes)</h4>
        <div class="board" id="rule-board"></div>
        <div style="margin-top:6px">
          <button id="toggle-rules-btn" class="toggle-btn" style="display:none">Show more</button>
        </div>
        <div id="gene-inspector" class="control-group" style="margin-top:6px">
          <h4>Gene Inspector</h4>
          <div id="gene-inspector-body" style="font-size:.9rem; color:#374151">
            Hover a rule tile to see its description. Click a tile to enable/disable that rule.
          </div>
        </div>
      </div>
      <div id="node-inspector" class="control-group">
        <h4>Node Inspector</h4>
        <div id="node-inspector-body" style="font-size:.9rem; color:#374151">
          Select the üñêÔ∏è Move tool, then hover a node to see details.
        </div>
      </div>

      <details class="block" id="settings-block">
        <summary>‚öôÔ∏è Machine settings</summary>
        <div class="row" style="margin-top:6px">
          <label for="max-steps-input">Max iterations:</label>
          <input id="max-steps-input" type="number" value="120" min="-1" step="1" style="width:120px">
          <small>(-1 = unlimited)</small>
        </div>
      </details>

      <details class="block" id="advanced-block">
        <summary>üß™ Advanced (debug)</summary>
        <div class="row" style="margin:6px 0">
          <label for="display-options">Display:</label>
          <select id="display-options">
            <option value="edges">Edges</option>
            <option value="nodes">Nodes</option>
            <option value="both">Nodes & edges</option>
          </select>
        </div>
        <div class="row" style="margin:6px 0">
          <label for="simulation-interval">Interval (ms):</label>
          <input type="range" id="simulation-interval" min="50" max="2000" value="100">
          <span id="simulation-interval-value">100</span> ms
        </div>

        <div class="control-buttons">
          <button id="connect-button">Connect</button>
          <label for="source-node">Source:</label>
          <select id="source-node"></select>
          <label for="target-node">Target:</label>
          <select id="target-node"></select>
        </div>
        <div class="control-buttons">
          <button id="add-node-button">Add Node</button>
          <label for="node-state">State:</label>
          <select id="node-state"></select>
        </div>
        <div class="control-buttons">
          <button id="remove-node-button">Remove Node</button>
          <label for="remove-node-id">Node ID:</label>
          <select id="remove-node-id"></select>
        </div>
        <div class="control-buttons">
          <button id="change-node-state-button">Change Node State</button>
          <label for="change-node-id">Node:</label>
          <select id="change-node-id"></select>
          <label for="change-node-state">State:</label>
          <select id="change-node-state"></select>
        </div>
        <div class="control-buttons">
          <button id="disconnect-button">Disconnect</button>
          <label for="disconnect-source-node">Source:</label>
          <select id="disconnect-source-node"></select>
          <label for="disconnect-target-node">Target:</label>
          <select id="disconnect-target-node"></select>
        </div>
        <div class="control-buttons">
          <button id="connect-nearest-button">Connect Nearest</button>
          <label for="connect-nearest-node">Node:</label>
          <select id="connect-nearest-node"></select>
          <label for="connect-nearest-state">State:</label>
          <select id="connect-nearest-state"></select>
        </div>
      </details>

      <div class="control-group">
        <div class="row">
          <button id="pause-resume-button">Start</button>
          <button id="next-step-button">Next step</button>
          <button id="reset-button">Reset</button>
        </div>
      </div>
    </aside>
  </div>

  <footer>
    <div class="left">
      <span id="status-info">Nodes: 0 | Edges: 0 | Iterations: 0</span>
    </div>
    <div class="right">
      <span class="pill">Zoom: wheel ‚Ä¢ Pan: drag (Move)</span>
    </div>
  </footer>

  <script src="dist/bundle.js" type="module"></script>
</body>
</html>
